<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ã“ã©ã‚‚ ã¨ã‘ã„ + ã‚¿ã‚¤ãƒãƒ¼</title>
<style>
  :root{
    --bg:#fffaf2;
    --ink:#202124;
    --muted:#5f6368;
    --accent:#3a86ff;
    --good:#1e9e77;
    --bad:#e85b4f;
    --panel:#ffffff;
    --ring:#e8eaed;
    --chip:#f1f3f4;
    --container: 980px;   /* ç”»é¢ã®æœ€å¤§å¹… */
    --clock-max: 520px;   /* æ™‚è¨ˆã®æœ€å¤§ã‚µã‚¤ã‚º */
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif;
    background: radial-gradient(1200px 800px at 70% -10%, #eef6ff 0%, var(--bg) 40%) no-repeat;
    color:var(--ink);
    display:flex;
    justify-content:center;
    align-items:center;
    padding:16px;
  }
  .app{
    width: min(var(--container), 100%);
    margin-inline: auto;
    display:grid;
    grid-template-columns: 2fr 1fr; /* æ™‚è¨ˆã‚’å¤§ãã‚ã€ã‚¿ã‚¤ãƒãƒ¼å°ã•ã‚ */
    gap:16px;
  }
  @media (max-width: 920px){ .app{grid-template-columns:1fr} }
  .card{
    background:var(--panel);
    border:1px solid var(--ring);
    border-radius:16px;
    box-shadow: 0 10px 24px rgba(0,0,0,.05);
    padding:16px;
  }
  .clock-wrap{display:grid; grid-template-rows:auto 1fr auto; gap:12px; height:100%}
  .toolbar{display:flex; flex-wrap:wrap; gap:8px; align-items:center; justify-content:space-between}
  .mode{display:flex; gap:6px; background:#f7f7fb; border-radius:999px; padding:6px; border:1px solid var(--ring)}
  .mode button{border:0; background:transparent; padding:8px 14px; border-radius:999px; cursor:pointer; font-weight:700; color:var(--muted)}
  .mode button.active{background:var(--accent); color:white}
  .activity{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
  .chip{background:var(--chip); border:1px solid var(--ring); padding:8px 12px; border-radius:999px; cursor:pointer; font-weight:700}
  .chip.active{background:#e7f0ff; border-color:#cfe0ff; color:#104cbd}
  .digital{font-feature-settings:"tnum"; font-variant-numeric:tabular-nums; font-size:1.6rem; font-weight:800}
  .muted{color:var(--muted)}
  .legend{display:flex; gap:10px; align-items:center; flex-wrap:wrap; font-size:.95rem}
  .dot{width:12px; height:12px; border-radius:50%}
  .dot.hour{background:#111}
  .dot.min{background:#777}
  .dot.sec{background:#d00}
  .status{display:flex; gap:8px; align-items:center; justify-content:space-between; font-weight:700}
  button{border:1px solid var(--ring); background:white; padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:700}
  button.primary{background:var(--accent); color:white; border-color:transparent}
  button.ghost{background:transparent}
  select,input[type="number"],input[type="text"]{border:1px solid var(--ring); background:white; padding:10px 12px; border-radius:12px; font-weight:700}
  .row{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
  .timer-panel{display:grid; gap:12px}
  .nowDoing{font-size:1.05rem; font-weight:800}
  .big{font-size:1.25rem}
  .grid2{display:grid; grid-template-columns:1fr 1fr; gap:8px}
  @media (max-width:480px){ .grid2{grid-template-columns:1fr} }
  .clock{
    width: 100%;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:8px 0;
  }
  #clock{
    width:100%;
    height:auto;
    max-width: var(--clock-max);
  }
</style>
</head>
<body>
  <div class="app">
    <div class="card clock-wrap">
      <div class="toolbar">
        <div class="left row">
          <div class="mode" role="tablist" aria-label="ãƒ¢ãƒ¼ãƒ‰">
            <button class="active" data-mode="learn">ã‚Œã‚“ã—ã‚…ã†</button>
            <button data-mode="realtime">ã„ã¾ã®ã˜ã‹ã‚“</button>
          </div>
          <div class="pill digital" id="digital">--:--</div>
        </div>
        <div class="right row">
          <button id="randomBtn" class="primary">ãƒ©ãƒ³ãƒ€ãƒ </button>
          <button id="resetBtn" class="ghost">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
      </div>

      <div class="activity">
        <span class="muted">ã„ã¾ï¼š</span>
        <span id="nowDoing" class="nowDoing">æœªè¨­å®š</span>
      </div>

      <div class="clock">
        <svg id="clock" viewBox="-160 -160 320 320" aria-label="ã‚¢ãƒŠãƒ­ã‚°æ™‚è¨ˆ" role="img">
          <circle r="145" fill="#fff" stroke="#dfe3e8" stroke-width="2"></circle>
          <g id="hours"></g>
          <g id="minTicks"></g>
          <g id="hands">
            <line id="hourHand" x1="0" y1="12" x2="0" y2="-75" stroke="#111" stroke-width="6" stroke-linecap="round"></line>
            <line id="minHand"  x1="0" y1="16" x2="0" y2="-118" stroke="#555" stroke-width="4" stroke-linecap="round"></line>
            <line id="secHand"  x1="0" y1="20" x2="0" y2="-125" stroke="#d00" stroke-width="2" stroke-linecap="round"></line>
            <circle r="5" fill="#111"></circle>
          </g>
        </svg>
      </div>

      <div class="status">
        <div class="legend muted">
          <span class="dot hour"></span><span>æ™‚é‡</span>
          <span class="dot min"></span><span>åˆ†é‡</span>
          <span class="dot sec"></span><span>ç§’é‡</span>
        </div>
        <div id="msg" class="muted">ãƒ¢ãƒ¼ãƒ‰ï¼šã‚Œã‚“ã—ã‚…ã†ï¼ˆãƒ‰ãƒ©ãƒƒã‚°ã§å‹•ãã‚ˆï¼‰</div>
      </div>
    </div>

    <div class="card timer-panel">
      <div>
        <div class="row">
          <span class="big">ã‚¿ã‚¤ãƒãƒ¼ â±ï¸</span>
          <button id="startTimer" class="primary">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
          <button id="pauseTimer">ä¸€æ™‚åœæ­¢</button>
          <button id="resetTimer" class="ghost">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
        <div class="row">
          <label>åˆ† <input id="tMin" type="number" min="0" max="120" value="5" style="width:90px"></label>
          <label>ç§’ <input id="tSec" type="number" min="0" max="59" value="0" style="width:90px"></label>
          <span class="digital" id="remain">05:00</span>
        </div>
      </div>

      <div>
        <div class="row"><span class="big">ã“ãˆ</span>
          <label><input type="checkbox" id="voiceOn" checked> ã—ã‚ƒã¹ã‚‹</label>
          <label><input type="checkbox" id="minAnn" checked> æ¯åˆ†ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³</label>
          <label><input type="checkbox" id="last10" checked> æœ€å¾Œ10ç§’ã‚«ã‚¦ãƒ³ãƒˆ</label>
        </div>
        <div class="grid2">
          <label>ã‚ˆã¿ã‚ã’ãƒ†ã‚¹ãƒˆï¼š
            <input type="text" id="sayText" value="ã“ã‚“ã«ã¡ã¯ã€‚ã‚¿ã‚¤ãƒãƒ¼ã®ãƒ†ã‚¹ãƒˆã§ã™ã€‚">
          </label>
          <div class="row">
            <label>ã‚¹ãƒ”ãƒ¼ãƒ‰
              <input type="range" id="rate" min="0.6" max="1.4" step="0.05" value="1">
            </label>
            <label>é«˜ã•
              <input type="range" id="pitch" min="0.8" max="1.2" step="0.05" value="1">
            </label>
            <button id="sayBtn">â–¶ï¸ ã‚ˆã‚€</button>
          </div>
        </div>
      </div>

      <div>
        <div class="row"><span class="big">ãªã«ã‚’ã—ã¦ã‚‹ï¼Ÿ</span>
          <div id="activityChips" class="row"></div>
        </div>
        <div class="row">
          <input type="text" id="customAct" placeholder="ã‚«ã‚¹ã‚¿ãƒ ï¼ˆä¾‹ï¼šãŠã‹ãŸã¥ã‘ï¼‰" style="flex:1">
          <button id="addAct">è¿½åŠ </button>
        </div>
      </div>
    </div>
  </div>

<script>
/* ===== Utility ===== */
const $ = s => document.querySelector(s);
const two = n => String(Math.floor(n)).padStart(2,'0');

/* ===== æ–‡å­—ç›¤ã®æç”» ===== */
const hoursG = document.getElementById('hours');
const minsG  = document.getElementById('minTicks');

// æ™‚æ•°å­—ï¼ˆ1ã€œ12ï¼‰
for(let i=1;i<=12;i++){
  const a = (i/12)*2*Math.PI;
  const x = Math.sin(a)*100;
  const y = -Math.cos(a)*100;
  const txt = document.createElementNS('http://www.w3.org/2000/svg','text');
  txt.setAttribute('x', x);
  txt.setAttribute('y', y+6);
  txt.setAttribute('text-anchor','middle');
  txt.setAttribute('font-size','18');
  txt.setAttribute('font-weight','700');
  txt.textContent = i;
  hoursG.appendChild(txt);
}

// ç›®ç››ã‚Šï¼ˆåˆ†ï¼‰
for(let i=0;i<60;i++){
  const a = (i/60)*2*Math.PI;
  const x1 = Math.sin(a)*126;
  const y1 = -Math.cos(a)*126;
  const x2 = Math.sin(a)*(i%5===0?135:140);
  const y2 = -Math.cos(a)*(i%5===0?135:140);
  const tick = document.createElementNS('http://www.w3.org/2000/svg','line');
  tick.setAttribute('x1',x1); tick.setAttribute('y1',y1);
  tick.setAttribute('x2',x2); tick.setAttribute('y2',y2);
  tick.setAttribute('stroke', i%5===0 ? '#222' : '#bbb');
  tick.setAttribute('stroke-width', i%5===0 ? '2.5':'1');
  minsG.appendChild(tick);

  if(i%5===0){
    const label = document.createElementNS('http://www.w3.org/2000/svg','text');
    const lx = Math.sin(a)*90;
    const ly = -Math.cos(a)*90 + 5;
    label.setAttribute('x', lx);
    label.setAttribute('y', ly);
    label.setAttribute('text-anchor','middle');
    label.setAttribute('font-size','10');
    label.setAttribute('fill','#666');
    label.textContent = i;
    minsG.appendChild(label);
  }
}

/* ===== çŠ¶æ…‹ ===== */
let mode = 'learn';
let hour=3, minute=0, second=0;
let rtId=null, learnDrag=null;

const hourHand = $('#hourHand'), minHand=$('#minHand'), secHand=$('#secHand');
const digital = $('#digital'), msg = $('#msg');

function updateHands(){
  const hAng = ((hour%12)+minute/60+second/3600)*30;
  const mAng = (minute + second/60)*6;
  const sAng = second*6;
  hourHand.setAttribute('transform',`rotate(${hAng})`);
  minHand.setAttribute('transform',`rotate(${mAng})`);
  secHand.setAttribute('transform',`rotate(${sAng})`);
  digital.textContent = `${two(hour)}:${two(minute)}`;
}

/* ===== ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ ===== */
function setMode(m){
  mode=m;
  document.querySelectorAll('.mode button').forEach(b=>b.classList.toggle('active', b.dataset.mode===m));
  if(rtId){ cancelAnimationFrame(rtId); rtId=null; }
  if(mode==='realtime'){
    msg.textContent='ãƒ¢ãƒ¼ãƒ‰ï¼šã„ã¾ã®ã˜ã‹ã‚“ï¼ˆç§’é‡ã‚ã‚Šï¼‰';
    function tick(){
      const d=new Date();
      hour=d.getHours(); minute=d.getMinutes(); second=d.getSeconds();
      updateHands();
      rtId=requestAnimationFrame(tick);
    }
    tick();
  }else{
    msg.textContent='ãƒ¢ãƒ¼ãƒ‰ï¼šã‚Œã‚“ã—ã‚…ã†ï¼ˆãƒ‰ãƒ©ãƒƒã‚°ã§å‹•ãã‚ˆï¼‰';
    second=0; updateHands();
  }
}
document.querySelectorAll('.mode button').forEach(btn=>btn.addEventListener('click',()=>setMode(btn.dataset.mode)));

/* ===== é‡ãƒ‰ãƒ©ãƒƒã‚°ï¼ˆã‚Œã‚“ã—ã‚…ã†ï¼‰ ===== */
const svg = document.getElementById('clock');
function angleFromEvent(evt){
  const rect = svg.getBoundingClientRect();
  const cx = rect.left + rect.width/2;
  const cy = rect.top + rect.height/2;
  const x = (evt.touches?evt.touches[0].clientX:evt.clientX)-cx;
  const y = (evt.touches?evt.touches[0].clientY:evt.clientY)-cy;
  const a = Math.atan2(y,x); // å³æ–¹å‘ãŒ0
  let deg = (a*180/Math.PI)+90; // 12æ™‚ãŒ0
  return (deg+360)%360;
}
function onDown(e){
  if(mode!=='learn') return;
  const a = angleFromEvent(e);
  const mAng = minute*6;
  const hAng = ((hour%12)+minute/60)*30;
  const distM = Math.min(Math.abs((a-mAng+360)%360), Math.abs((mAng-a+360)%360));
  const distH = Math.min(Math.abs((a-hAng+360)%360), Math.abs((hAng-a+360)%360));
  learnDrag = distM<distH ? 'min' : 'hour';
  document.body.style.userSelect='none';
}
function onMove(e){
  if(!learnDrag || mode!=='learn') return;
  const a = angleFromEvent(e);
  if(learnDrag==='min'){
    minute = Math.round(a/6)%60;
  }else{
    const h = (a/30)%12;
    const base = Math.floor(hour/12)*12;
    hour = base + Math.round(h)%12;
  }
  updateHands();
}
function onUp(){ learnDrag=null; document.body.style.userSelect=''; }
svg.addEventListener('mousedown',onDown);
svg.addEventListener('mousemove',onMove);
window.addEventListener('mouseup',onUp);
svg.addEventListener('touchstart',onDown,{passive:true});
svg.addEventListener('touchmove',onMove,{passive:true});
window.addEventListener('touchend',onUp);

/* ===== ãƒœã‚¿ãƒ³ ===== */
$('#randomBtn').addEventListener('click',()=>{
  hour = Math.floor(Math.random()*24);
  minute = Math.floor(Math.random()*60);
  second = 0;
  updateHands();
});
$('#resetBtn').addEventListener('click',()=>{ hour=3; minute=0; second=0; updateHands(); });

/* ===== ã‚¿ã‚¤ãƒãƒ¼ ===== */
let timerId=null, endAt=null, pausedRemain=0;
const tMin=$('#tMin'), tSec=$('#tSec'), remain=$('#remain');

function speak(text){
  if(!$('#voiceOn').checked) return;
  const u = new SpeechSynthesisUtterance(text);
  // æ—¥æœ¬èªãƒœã‚¤ã‚¹ã‚’å„ªå…ˆ
  const vs = speechSynthesis.getVoices();
  const ja = vs.find(v=>v.lang && v.lang.toLowerCase().startsWith('ja'));
  if(ja) u.voice = ja;
  u.rate = Number($('#rate').value);
  u.pitch = Number($('#pitch').value);
  try{ speechSynthesis.cancel(); }catch(e){}
  speechSynthesis.speak(u);
}
function updateRemain(){
  if(!endAt){ remain.textContent = `${two(Number(tMin.value))}:${two(Number(tSec.value))}`; return; }
  const ms = endAt - Date.now();
  const s = Math.max(0, Math.round(ms/1000));
  remain.textContent = `${two(Math.floor(s/60))}:${two(s%60)}`;
}
function startTimer(){
  const total = (Number(tMin.value)*60 + Number(tSec.value)) * 1000;
  const act = currentActivity();
  if(total<=0){ speak('ã‚¿ã‚¤ãƒãƒ¼æ™‚é–“ã‚’è¨­å®šã—ã¦ã­'); return; }
  endAt = Date.now() + (pausedRemain || total);
  const everySecond = ()=>{
    const left = endAt - Date.now();
    // æ¯åˆ†ã‚¢ãƒŠã‚¦ãƒ³ã‚¹
    if($('#minAnn').checked){
      const s = Math.round(left/1000);
      if(s>0 && s%60===0){
        const m = Math.floor(s/60);
        speak(`${m}åˆ†ã®ã“ã‚Š`);
      }
    }
    // æœ€å¾Œ10ç§’
    if($('#last10').checked){
      const s = Math.round(left/1000);
      if(s<=10 && s>0){ speak(String(s)); }
    }
    // çµ‚äº†
    if(left<=0){
      clearInterval(timerId); timerId=null;
      pausedRemain=0; endAt=null;
      updateRemain();
      const label = act ? `ã€Œ${act}ã€` : '';
      speak(`ã‚¿ã‚¤ãƒãƒ¼çµ‚äº†ã€‚${label}ãŠã‚ã‚Š`);
      return;
    }
    updateRemain();
  };
  updateRemain();
  if(timerId) clearInterval(timerId);
  timerId = setInterval(everySecond, 1000);
  const secStr = (total/1000)%60 ? `${(total/1000)%60}ç§’` : '';
  speak(`ã‚¿ã‚¤ãƒãƒ¼ã‚’é–‹å§‹ã€‚${Math.floor(total/60000)}åˆ†${secStr}` + (act? `ã€ã„ã¾ã¯ ${act}`:''));
}
function pauseTimer(){
  if(!endAt) return;
  pausedRemain = Math.max(0, endAt - Date.now());
  endAt=null;
  if(timerId) clearInterval(timerId);
  timerId=null;
  speak('ã„ã£ãŸã‚“ ãã‚…ã†ã‘ã„');
}
function resetTimer(){
  endAt=null; pausedRemain=0;
  if(timerId) clearInterval(timerId); timerId=null;
  updateRemain();
}
$('#startTimer').addEventListener('click', startTimer);
$('#pauseTimer').addEventListener('click', pauseTimer);
$('#resetTimer').addEventListener('click', resetTimer);
tMin.addEventListener('change',updateRemain);
tSec.addEventListener('change',updateRemain);

// èª­ã¿ä¸Šã’ãƒ†ã‚¹ãƒˆ
$('#sayBtn').addEventListener('click',()=>speak($('#sayText').value));

/* ===== æ´»å‹•ï¼ˆã”é£¯/å‹‰å¼·/éŠã³/å‹•ç”»ï¼‹ã‚«ã‚¹ã‚¿ãƒ ï¼‰ ===== */
const defaultActs = [
  {label:'ã”é£¯', emoji:'ğŸš'},
  {label:'å‹‰å¼·', emoji:'âœï¸'},
  {label:'éŠã³', emoji:'ğŸ²'},
  {label:'å‹•ç”»', emoji:'ğŸ“º'}
];
function loadActs(){
  const saved = JSON.parse(localStorage.getItem('acts')||'[]');
  return saved.length ? saved : defaultActs;
}
function saveActs(list){
  localStorage.setItem('acts', JSON.stringify(list));
}
function renderActs(){
  const box = $('#activityChips'); box.innerHTML='';
  acts.forEach((a,idx)=>{
    const btn = document.createElement('button');
    btn.className='chip'+(idx===actIdx?' active':'');
    btn.textContent = `${a.emoji||''} ${a.label}`;
    btn.addEventListener('click',()=>{ actIdx=idx; renderActs(); updateNowDoing(); });
    box.appendChild(btn);
  });
}
function updateNowDoing(){
  const a=currentActivity();
  $('#nowDoing').textContent = a || 'æœªè¨­å®š';
}
function currentActivity(){
  return acts[actIdx]?.label ? `${acts[actIdx].emoji||''} ${acts[actIdx].label}` : '';
}
let acts = loadActs();
let actIdx = 0;
renderActs(); updateNowDoing();

$('#addAct').addEventListener('click',()=>{
  const t = $('#customAct').value.trim();
  if(!t) return;
  acts.push({label:t, emoji:'â­'});
  saveActs(acts);
  actIdx = acts.length-1;
  $('#customAct').value='';
  renderActs(); updateNowDoing();
});

/* ===== åˆæœŸåŒ– ===== */
function initVoices(){ try{ speechSynthesis.getVoices(); }catch(e){} }
if(typeof speechSynthesis!=='undefined'){
  speechSynthesis.onvoiceschanged = initVoices;
  initVoices();
}
hour=3; minute=0; second=0; updateHands();
setMode('learn');

</script>
</body>
</html>
